<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<form [formGroup]="form()" (ngSubmit)="onSubmit()" class="space-y-6">
  <!-- Basic Information Section -->
  <div class="flex flex-col gap-3">
    <!-- Topic (Required) -->
    <div>
      <label for="meeting-topic" class="block text-sm font-medium text-gray-700 mb-1"> Title <span class="text-red-500">*</span> </label>
      <lfx-input-text size="small" [form]="form()" control="topic" id="meeting-topic" placeholder="Enter meeting title" styleClass="w-full"></lfx-input-text>
      <p class="mt-1 text-sm text-red-600" *ngIf="form().get('topic')?.errors?.['required'] && form().get('topic')?.touched">Meeting topic is required</p>
    </div>

    <!-- Agenda -->
    <div>
      <label for="meeting-agenda" class="block text-sm font-medium text-gray-700 mb-1"> Agenda </label>
      <lfx-textarea
        [form]="form()"
        control="agenda"
        id="meeting-agenda"
        placeholder="Enter meeting agenda"
        [rows]="4"
        styleClass="w-full max-h-40 overflow-y-auto"></lfx-textarea>
    </div>

    <!-- Meeting Type -->
    <div>
      <label for="meeting-type" class="block text-sm font-medium text-gray-700 mb-1"> Meeting Type </label>
      <lfx-select
        size="small"
        [form]="form()"
        control="meeting_type"
        [options]="meetingTypeOptions"
        placeholder="Select meeting type"
        styleClass="w-full"
        id="meeting-type"></lfx-select>
      <p class="mt-1 text-sm text-red-600" *ngIf="form().get('meeting_type')?.errors?.['required'] && form().get('meeting_type')?.touched">
        Meeting type is required
      </p>
    </div>
  </div>

  <!-- Date & Time Section -->
  <div class="flex flex-col gap-3">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Start Date -->
      <div>
        <label for="start-date" class="block text-sm font-medium text-gray-700 mb-1"> Start Date <span class="text-red-500">*</span> </label>
        <lfx-calendar
          [form]="form()"
          control="startDate"
          id="start-date"
          placeholder="Select date"
          [showIcon]="true"
          [minDate]="minDate()"
          styleClass="w-full"></lfx-calendar>
        <p class="mt-1 text-sm text-red-600" *ngIf="form().get('startDate')?.errors?.['required'] && form().get('startDate')?.touched">
          Start date is required
        </p>
      </div>

      <!-- Start Time -->
      <div>
        <label for="start-time" class="block text-sm font-medium text-gray-700 mb-1"> Start Time <span class="text-red-500">*</span> </label>
        <lfx-time-picker [form]="form()" control="startTime" id="start-time" placeholder="Select time" styleClass="w-full" width="w-48"></lfx-time-picker>
        <p class="mt-1 text-sm text-red-600" *ngIf="form().get('startTime')?.errors?.['required'] && form().get('startTime')?.touched">
          Start time is required
        </p>
      </div>

      <!-- Duration -->
      <div>
        <label for="duration" class="block text-sm font-medium text-gray-700 mb-1"> Duration <span class="text-red-500">*</span> </label>
        <lfx-select
          size="small"
          [form]="form()"
          control="duration"
          [options]="durationOptions"
          placeholder="Select duration"
          styleClass="w-full"
          id="duration"></lfx-select>
        <p class="mt-1 text-sm text-red-600" *ngIf="form().get('duration')?.errors?.['required'] && form().get('duration')?.touched">Duration is required</p>
      </div>
    </div>

    <!-- Future Date/Time validation error -->
    <p class="mt-1 text-sm text-red-600" *ngIf="form().errors?.['futureDateTime'] && (form().get('startDate')?.touched || form().get('startTime')?.touched)">
      Meeting must be scheduled in the future
    </p>

    <!-- Custom Duration (shown when 'custom' is selected) -->
    @if (this.form().get('duration')?.value === 'custom') {
      <div>
        <label for="custom-duration" class="block text-sm font-medium text-gray-700 mb-1">
          Custom Duration (minutes) <span class="text-red-500">*</span>
        </label>
        <lfx-input-text
          size="small"
          [form]="form()"
          control="customDuration"
          id="custom-duration"
          placeholder="Enter minutes"
          type="number"
          styleClass="w-full"></lfx-input-text>
        <p class="mt-1 text-sm text-red-600" *ngIf="form().get('customDuration')?.errors?.['required'] && form().get('customDuration')?.touched">
          Custom duration is required
        </p>
        <p class="mt-1 text-sm text-red-600" *ngIf="form().get('customDuration')?.errors?.['min'] && form().get('customDuration')?.touched">
          Custom duration must be greater than 5 minutes
        </p>
        <p class="mt-1 text-sm text-red-600" *ngIf="form().get('customDuration')?.errors?.['max'] && form().get('customDuration')?.touched">
          Custom duration must be less than 480 minutes
        </p>
      </div>
    }

    <!-- Timezone -->
    <div>
      <label for="timezone" class="block text-sm font-medium text-gray-700 mb-1"> Timezone <span class="text-red-500">*</span> </label>
      <lfx-select
        size="small"
        [filter]="true"
        [form]="form()"
        control="timezone"
        [options]="timezoneOptions"
        placeholder="Select timezone"
        styleClass="w-full"
        id="timezone"></lfx-select>
      <p class="mt-1 text-sm text-red-600" *ngIf="form().get('timezone')?.errors?.['required'] && form().get('timezone')?.touched">Timezone is required</p>
    </div>

    <!-- Recurrence -->
    @if (!isEditingSingleOccurrence()) {
      <div>
        <div class="flex items-center gap-2 mb-1">
          <label for="recurrence" class="block text-sm font-medium text-gray-700"> Repeat </label>
          <i
            class="fa-light fa-info-circle text-gray-400 cursor-help"
            pTooltip="Set up recurring meetings that repeat daily, weekly, monthly, or on weekdays"
            tooltipPosition="right"
            tooltipStyleClass="text-xs max-w-xs"></i>
        </div>
        <lfx-select
          size="small"
          [form]="form()"
          control="recurrence"
          [options]="recurrenceOptions()"
          placeholder="Select recurrence"
          styleClass="w-full"
          id="recurrence"></lfx-select>
      </div>
    }

    <!-- Early Join Time -->
    <div>
      <div class="flex items-center gap-2 mb-1">
        <label for="early-join-time" class="block text-sm font-medium text-gray-700"> Early Join Time (minutes before start time) </label>
        <i
          class="fa-light fa-info-circle text-gray-400 cursor-help"
          pTooltip="Allow participants to join the meeting early. Useful for informal networking before the official start time"
          tooltipPosition="right"
          tooltipStyleClass="text-xs max-w-xs"></i>
      </div>
      <lfx-input-text
        size="small"
        [form]="form()"
        control="early_join_time"
        id="early-join-time"
        placeholder="Enter minutes"
        type="number"
        styleClass="w-full"></lfx-input-text>
    </div>
  </div>

  <!-- Meeting Settings Section -->
  @if (!isEditingSingleOccurrence()) {
    <div class="flex flex-col gap-3">
      <h3 class="text-lg font-medium text-gray-900">Meeting Settings</h3>

      <!-- Public Calendar Visibility -->
      <div class="flex flex-col gap-2">
        <div class="flex items-center gap-2">
          <lfx-toggle size="small" [form]="form()" control="show_in_public_calendar" label="Show in Public Calendar" id="public-calendar-toggle"></lfx-toggle>
          <i
            class="fa-light fa-info-circle text-gray-400 cursor-help"
            pTooltip="When enabled, this meeting will be visible on the project's public calendar"
            tooltipPosition="right"
            tooltipStyleClass="text-xs max-w-xs"></i>
        </div>
      </div>

      <!-- Restricted Meeting -->
      <div class="flex flex-col gap-2">
        <div class="flex items-center gap-2">
          <lfx-toggle size="small" [form]="form()" control="restricted" label="Restricted Meeting" id="restricted-toggle"></lfx-toggle>
          <i
            class="fa-light fa-info-circle text-gray-400 cursor-help"
            pTooltip="When enabled, this meeting will have restricted access and only invited participants can join"
            tooltipPosition="right"
            tooltipStyleClass="text-xs max-w-xs"></i>
        </div>
      </div>

      <!-- Recording Settings -->
      <div class="flex flex-col gap-2">
        <div class="flex items-center gap-2">
          <lfx-toggle size="small" [form]="form()" control="recording_enabled" label="Enable Recording" id="recording-toggle"></lfx-toggle>
          <i
            class="fa-light fa-info-circle text-gray-400 cursor-help"
            pTooltip="Record the meeting for later viewing. Required for transcripts and automatic YouTube uploads"
            tooltipPosition="right"
            tooltipStyleClass="text-xs max-w-xs"></i>
        </div>

        <!-- Recording-dependent features -->
        @if (form().get('recording_enabled')?.value === true) {
          <div>
            <div class="flex items-center gap-2 mb-1">
              <label for="recording-access" class="block text-sm font-medium text-gray-700">Recording Access</label>
              <i
                class="fa-light fa-info-circle text-gray-400 cursor-help"
                pTooltip="Control who can access the meeting recordings"
                tooltipPosition="right"
                tooltipStyleClass="text-xs max-w-xs"></i>
            </div>
            <lfx-select
              size="small"
              [form]="form()"
              control="recording_access"
              [options]="recordingAccessOptions"
              id="recording-access"
              placeholder="Select recording access level">
            </lfx-select>
          </div>
          <div class="flex items-center gap-2">
            <lfx-toggle size="small" [form]="form()" control="transcripts_enabled" label="Enable Transcripts" id="transcripts-toggle"></lfx-toggle>
            <i
              class="fa-light fa-info-circle text-gray-400 cursor-help"
              pTooltip="Generate automated transcripts from the meeting recording"
              tooltipPosition="right"
              tooltipStyleClass="text-xs max-w-xs"></i>
          </div>

          <div class="flex items-center gap-2">
            <lfx-toggle size="small" [form]="form()" control="youtube_enabled" label="Enable YouTube Upload" id="youtube-toggle"></lfx-toggle>
            <i
              class="fa-light fa-info-circle text-gray-400 cursor-help"
              pTooltip="Automatically upload the meeting recording to YouTube after the meeting ends"
              tooltipPosition="right"
              tooltipStyleClass="text-xs max-w-xs"></i>
          </div>
        }
      </div>

      <!-- Zoom AI Settings -->
      <div class="flex flex-col gap-2">
        <div class="flex items-center gap-2">
          <lfx-toggle size="small" [form]="form()" control="zoom_ai_enabled" label="Enable Zoom AI" id="zoom-ai-toggle"></lfx-toggle>
          <i
            class="fa-light fa-info-circle text-gray-400 cursor-help"
            pTooltip="Use Zoom's AI features to generate meeting summaries and insights"
            tooltipPosition="right"
            tooltipStyleClass="text-xs max-w-xs"></i>
        </div>

        <!-- Zoom AI dependent features -->
        @if (form().get('zoom_ai_enabled')?.value === true) {
          <div class="flex items-center gap-2">
            <lfx-toggle
              size="small"
              [form]="form()"
              control="require_ai_summary_approval"
              label="Require AI Summary Approval"
              id="ai-approval-toggle"></lfx-toggle>
            <i
              class="fa-light fa-info-circle text-gray-400 cursor-help"
              pTooltip="Require manual review and approval before publishing AI-generated summaries"
              tooltipPosition="right"
              tooltipStyleClass="text-xs max-w-xs"></i>
          </div>

          <div>
            <div class="flex items-center gap-2 mb-1">
              <label for="ai-summary-access" class="block text-sm font-medium text-gray-700"> AI Summary Access </label>
              <i
                class="fa-light fa-info-circle text-gray-400 cursor-help"
                pTooltip="Control who can access the AI-generated meeting summaries"
                tooltipPosition="right"
                tooltipStyleClass="text-xs max-w-xs"></i>
            </div>
            <lfx-select
              size="small"
              [form]="form()"
              control="ai_summary_access"
              [options]="aiSummaryAccessOptions"
              placeholder="Select access level"
              styleClass="w-full"
              id="ai-summary-access"></lfx-select>
          </div>
        }
      </div>
    </div>
  }

  @if (!isEditing()) {
    <div class="flex flex-col gap-2">
      <div class="flex items-center gap-2">
        <label for="demo[]" class="block text-sm font-medium text-gray-700">Upload Meeting Attachments</label>
        <i
          class="fa-light fa-info-circle text-gray-400 cursor-help"
          pTooltip="Upload any meeting materials that will be shared with participants"
          tooltipPosition="right"
          tooltipStyleClass="text-xs max-w-xs"></i>
      </div>
      <lfx-file-upload
        name="attachments[]"
        [customUpload]="true"
        (onSelect)="onFileSelect($event)"
        [multiple]="true"
        accept="image/*, application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document"
        [maxFileSize]="10000000"
        [showUploadButton]="false"
        [showCancelButton]="true"
        chooseStyleClass="p-button-sm"
        cancelStyleClass="p-button-sm"
        mode="advanced"
        chooseLabel="Choose Files"
        cancelLabel="Clear">
        <ng-template #content>
          <div class="text-sm flex items-center justify-center">Drag and drop files to here to upload.</div>
        </ng-template>
      </lfx-file-upload>

      <!-- Show pending attachments -->
      @if (pendingAttachments().length > 0) {
        <div class="mt-4 space-y-2">
          <h4 class="text-sm font-medium text-gray-900">Selected Files:</h4>
          @for (attachment of pendingAttachments(); track attachment.id) {
            <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
              <div class="flex items-center space-x-2">
                @if (attachment.uploading) {
                  <i class="pi pi-spin pi-spinner text-blue-500"></i>
                } @else if (attachment.uploadError) {
                  <i class="pi pi-exclamation-triangle text-red-500"></i>
                } @else {
                  <i class="pi pi-check-circle text-green-500"></i>
                }
                <span class="text-sm text-gray-700">{{ attachment.fileName }}</span>
                <span class="text-xs text-gray-500">({{ attachment.fileSize / 1024 / 1024 | number: '1.1-1' }}MB)</span>
              </div>
              <div class="flex items-center space-x-2">
                @if (attachment.uploading) {
                  <span class="text-xs text-blue-600">Uploading...</span>
                } @else if (attachment.uploadError) {
                  <span class="text-xs text-red-600">{{ attachment.uploadError }}</span>
                } @else {
                  <span class="text-xs text-green-600">Ready</span>
                }
                <button type="button" (click)="removePendingAttachment(attachment.id)" class="text-red-500 hover:text-red-700">
                  <i class="pi pi-times text-xs"></i>
                </button>
              </div>
            </div>
          }
        </div>
      }
    </div>
  }

  <!-- Form Actions -->
  <div class="flex justify-end gap-3 pt-6 border-t">
    <lfx-button label="Cancel" severity="secondary" [outlined]="true" (click)="onCancel()" size="small" type="button"></lfx-button>
    <lfx-button
      [label]="isEditing() ? 'Update Meeting' : 'Create Meeting'"
      [loading]="submitting()"
      [disabled]="submitting()"
      type="submit"
      size="small"></lfx-button>
  </div>
</form>
